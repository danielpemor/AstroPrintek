---
import BaseLayout from '../../layouts/BaseLayout.astro';

const services = [
  'Industrial Procurement',
  'IT Equipment',
  'International Logistics',
  'Imports',
  'Consulting',
  'Other'
];
---

<BaseLayout title="Contact - Printek" description="Contact us for the best industrial and IT solutions. We're here to help you.">
  <!-- Hero Section -->
  <section class="bg-gradient-to-r from-industrial-900 to-primary-800 text-white py-20 mt-20">
    <div class="container mx-auto px-4 lg:px-6">
      <div class="max-w-4xl mx-auto text-center">
        <h1 class="text-5xl md:text-6xl font-heading font-bold mb-6">
          Contact Us
        </h1>
        <p class="text-xl text-industrial-100 leading-relaxed">
          We're ready to help you with your industrial and IT needs. 
          Let's talk about how we can optimize your operation.
        </p>
      </div>
    </div>
  </section>

  <!-- Contact Form Section - White Background -->
  <section class="py-20 bg-white">
    <div class="container mx-auto px-4 lg:px-6">
      <div class="max-w-4xl mx-auto">
        <div class="text-center mb-12">
          <h2 class="text-4xl font-heading font-bold text-slate-800 mb-6">
            Request Your Quote
          </h2>
          <p class="text-lg text-slate-600">
            Complete the form and we'll contact you within 24 hours with a personalized quote.
          </p>
        </div>

        <!-- Form -->
        <div class="bg-gradient-to-br from-slate-100 via-gray-50 to-blue-50 rounded-2xl shadow-xl p-8 border border-slate-200">
          <!-- Netlify Form with configured notifications -->
          <form 
            name="contact" 
            method="POST" 
            data-netlify="true" 
            data-netlify-honeypot="bot-field"
            data-netlify-recaptcha="true"
            netlify-to="sales@printeksupplies.com"
            action="/en/thank-you/"
          >
            <!-- Netlify form detection -->
            <input type="hidden" name="form-name" value="contact" />
            
            <!-- Enhanced honeypot field (multiple traps) -->
            <div style="display: none;">
              <label>Don't fill this out if you're human: 
                <input name="bot-field" tabindex="-1" autocomplete="off" />
              </label>
              <input name="website" type="url" style="display:none" />
              <input name="company-url" type="text" style="position:absolute;left:-9999px;" />
            </div>

            <!-- Hidden timestamp to detect very fast submissions -->
            <input type="hidden" name="timestamp" id="formTimestamp" />
            
            <!-- JavaScript verification field -->
            <input type="hidden" name="js-enabled" value="false" id="jsEnabled" />

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              <!-- Name -->
              <div>
                <label for="nombre" class="block text-sm font-semibold text-slate-700 mb-2">
                  Full Name *
                </label>
                <input
                  type="text"
                  id="nombre"
                  name="nombre"
                  required
                  minlength="2"
                  maxlength="100"
                  pattern="^[a-zA-ZÀ-ÿ\u00f1\u00d1\s]+$"
                  class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all duration-300 bg-white"
                  placeholder="Your full name"
                  data-error-message="Please enter a valid name (letters only, 2-100 characters)"
                />
                <div class="error-message text-red-500 text-sm mt-1 hidden"></div>
              </div>

              <!-- Email -->
              <div>
                <label for="email" class="block text-sm font-semibold text-slate-700 mb-2">
                  Email *
                </label>
                <input
                  type="email"
                  id="email"
                  name="email"
                  required
                  pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
                  class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all duration-300 bg-white"
                  placeholder="your@email.com"
                  data-error-message="Please enter a valid email"
                />
                <div class="error-message text-red-500 text-sm mt-1 hidden"></div>
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              <!-- Phone -->
              <div>
                <label for="telefono" class="block text-sm font-semibold text-slate-700 mb-2">
                  Phone
                </label>
                <input
                  type="tel"
                  id="telefono"
                  name="telefono"
                  pattern="[\+]?[0-9\s\-\(\)]+"
                  minlength="10"
                  class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all duration-300 bg-white"
                  placeholder="+1 915 123 4567"
                  data-error-message="Please enter a valid phone number (minimum 10 digits)"
                />
                <div class="error-message text-red-500 text-sm mt-1 hidden"></div>
              </div>

              <!-- Company -->
              <div>
                <label for="empresa" class="block text-sm font-semibold text-slate-700 mb-2">
                  Company *
                </label>
                <input
                  type="text"
                  id="empresa"
                  name="empresa"
                  required
                  minlength="2"
                  maxlength="100"
                  class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all duration-300 bg-white"
                  placeholder="Your company name"
                  data-error-message="Please enter your company name (2-100 characters)"
                />
                <div class="error-message text-red-500 text-sm mt-1 hidden"></div>
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              <!-- Company Location -->
              <div>
                <label for="ubicacion" class="block text-sm font-semibold text-slate-700 mb-2">
                  Company Location *
                </label>
                <input
                  type="text"
                  id="ubicacion"
                  name="ubicacion"
                  required
                  minlength="2"
                  maxlength="100"
                  class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all duration-300 bg-white"
                  placeholder="City, State, Country"
                  data-error-message="Please enter your company location"
                />
                <div class="error-message text-red-500 text-sm mt-1 hidden"></div>
              </div>

              <!-- Service of Interest -->
              <div>
                <label for="servicio" class="block text-sm font-semibold text-slate-700 mb-2">
                  Service of Interest *
                </label>
                <select
                  id="servicio"
                  name="servicio"
                  required
                  class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all duration-300 bg-white"
                  data-error-message="Please select a service"
                >
                  <option value="">Select a service</option>
                  <option value="Industrial Procurement">Industrial Procurement</option>
                  <option value="IT Equipment">IT Equipment</option>
                  <option value="International Logistics">International Logistics</option>
                  <option value="Imports">Imports</option>
                  <option value="Consulting">Consulting</option>
                  <option value="Other">Other</option>
                </select>
                <div class="error-message text-red-500 text-sm mt-1 hidden"></div>
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              <!-- Product Number -->
              <div>
                <label for="numeroProducto" class="block text-sm font-semibold text-slate-700 mb-2">
                  Product Number
                  <span class="text-slate-500 font-normal">(Optional)</span>
                </label>
                <input
                  type="text"
                  id="numeroProducto"
                  name="numeroProducto"
                  maxlength="50"
                  class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all duration-300 bg-white"
                  placeholder="Ex: HP-CF500A, DL380-GEN10"
                />
              </div>

              <!-- Brand and/or Model -->
              <div>
                <label for="marcaModelo" class="block text-sm font-semibold text-slate-700 mb-2">
                  Brand and/or Model
                  <span class="text-slate-500 font-normal">(Optional)</span>
                </label>
                <input
                  type="text"
                  id="marcaModelo"
                  name="marcaModelo"
                  maxlength="100"
                  class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all duration-300 bg-white"
                  placeholder="Ex: HP LaserJet Pro, Dell PowerEdge"
                />
              </div>
            </div>

            <!-- Message -->
            <div class="mb-6">
              <label for="mensaje" class="block text-sm font-semibold text-slate-700 mb-2">
                Project Description *
              </label>
              <textarea
                id="mensaje"
                name="mensaje"
                rows="4"
                required
                minlength="10"
                maxlength="1000"
                class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all duration-300 resize-y bg-white"
                placeholder="Describe your project, specific needs, product quantity, estimated delivery date, etc..."
                data-error-message="Please describe your project (minimum 10 characters)"
              ></textarea>
              <div class="error-message text-red-500 text-sm mt-1 hidden"></div>
              <div class="text-sm text-slate-500 mt-1">
                <span id="charCount">0</span>/1000 characters
              </div>
            </div>

            <!-- reCAPTCHA -->
            <div class="mb-6 flex justify-center">
              <div data-netlify-recaptcha="true"></div>
            </div>

            <!-- Submit Button -->
            <div class="text-center">
              <button
                type="submit"
                id="submitBtn"
                disabled
                class="w-full bg-gray-400 cursor-not-allowed text-white px-8 py-4 rounded-lg font-semibold transition-all duration-300 inline-flex items-center justify-center"
              >
                <img src="/images/email.png" alt="email" class="w-5 h-5 mr-2" />
                <span id="submitText">Please wait...</span>
              </button>
            </div>

            <!-- Privacy Note -->
            <div class="mt-4 text-center text-sm text-slate-500">
              By submitting this form, you agree that we process your information to respond to your inquiry.
              <br>
              <span class="text-xs">Protected by reCAPTCHA and anti-spam measures.</span>
            </div>
          </form>
        </div>
      </div>
    </div>
  </section>

<!-- Map and Locations Section -->
<section class="py-20 bg-gradient-to-br from-slate-100 via-gray-50 to-blue-50">
  <div class="container mx-auto px-4 lg:px-6">
    <div class="max-w-7xl mx-auto">
      <div class="text-center mb-12">
        <h2 class="text-4xl font-heading font-bold text-slate-800 mb-6">
          Our Locations
        </h2>
        <p class="text-lg text-slate-600">
          Strategically located offices to provide you the best service.
        </p>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
        <!-- Interactive Map -->
        <div class="bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden">
          <!-- Map fills entire container -->
          <div class="h-96">
            <iframe 
              id="googleMap"
              width="100%" 
              height="100%" 
              style="border:0;" 
              allowfullscreen="" 
              loading="lazy" 
              referrerpolicy="no-referrer-when-downgrade"
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3368.234567!2d-106.4085409!3d31.709317!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x86e75d350dd9eda9%3A0xa1ef15cd701b0240!2sDacodex%20%7C%20Oficinas%20amuebladas!5e0!3m2!1sen!2smx!4v1702000000001!5m2!1sen!2smx">
            </iframe>
          </div>
          
          <!-- Buttons below the map -->
          <div class="p-6 bg-gradient-to-r from-gray-50 to-slate-50">
            <h3 class="text-xl font-heading font-bold text-slate-800 mb-4 text-center">
              Select Location
            </h3>
            <div class="flex justify-center space-x-4">
              <button 
                id="showMexico" 
                class="flex items-center px-6 py-3 bg-red-200 ring-2 ring-red-300 rounded-xl transition-all duration-300 hover:shadow-md transform hover:-translate-y-0.5 group"
              >
                <img src="/images/mexico.png" alt="Mexico" class="w-6 h-6 mr-3 group-hover:scale-110 transition-transform">
                <span class="text-sm font-semibold text-gray-700">Mexico</span>
              </button>
              <button 
                id="showUSA" 
                class="flex items-center px-6 py-3 bg-blue-100 hover:bg-blue-200 rounded-xl transition-all duration-300 hover:shadow-md transform hover:-translate-y-0.5 group"
              >
                <img src="/images/estados-unidos.png" alt="United States" class="w-6 h-6 mr-3 group-hover:scale-110 transition-transform">
                <span class="text-sm font-semibold text-gray-700">United States</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Location Information -->
        <div class="space-y-8">
          <!-- United States -->
          <div class="bg-white rounded-2xl p-8 shadow-xl border border-slate-200 hover:shadow-2xl transition-all duration-300">
            <div class="flex items-start space-x-6">
              <div class="flex-shrink-0">
                <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center">
                  <img src="/images/estados-unidos.png" alt="United States" class="w-10 h-10">
                </div>
              </div>
              <div class="flex-1">
                <h4 class="text-2xl font-heading font-bold text-slate-800 mb-4 flex items-center">
                  United States
                  <span class="ml-3 px-3 py-1 bg-blue-100 text-blue-700 text-sm font-medium rounded-full">Headquarters</span>
                </h4>
                <div class="space-y-3 text-slate-600">
                  <div class="flex items-start space-x-3">
                    <svg class="w-5 h-5 text-blue-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
                    </svg>
                    <div>
                      <p class="font-semibold text-slate-800">Address:</p>
                      <p class="text-slate-600">11601 Pellicano Dr Suite D2<br>El Paso, TX 79936</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Mexico -->
          <div class="bg-white rounded-2xl p-8 shadow-xl border border-slate-200 hover:shadow-2xl transition-all duration-300">
            <div class="flex items-start space-x-6">
              <div class="flex-shrink-0">
                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center">
                  <img src="/images/mexico.png" alt="Mexico" class="w-10 h-10">
                </div>
              </div>
              <div class="flex-1">
                <h4 class="text-2xl font-heading font-bold text-slate-800 mb-4 flex items-center">
                  Mexico
                  <span class="ml-3 px-3 py-1 bg-red-100 text-red-700 text-sm font-medium rounded-full">Branch Office</span>
                </h4>
                <div class="space-y-3 text-slate-600">
                  <div class="flex items-start space-x-3">
                    <svg class="w-5 h-5 text-red-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
                    </svg>
                    <div>
                      <p class="font-semibold text-slate-800">Address:</p>
                      <p class="text-slate-600">Calle Manzanero 1918, Oficina MV117, Col. Sandra Lucía, Ciudad Juárez, Chihuahua, 32530</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

  <!-- Contact Information Section -->
  <section class="py-20 bg-white">
    <div class="container mx-auto px-4 lg:px-6">
      <div class="max-w-6xl mx-auto">
        <div class="text-center mb-12">
          <h2 class="text-4xl font-heading font-bold text-slate-800 mb-6">
            Contact Information
          </h2>
          <p class="text-lg text-slate-600">
            Multiple channels to connect with you in your preferred way.
          </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
          <!-- Email -->
          <div class="text-center">
            <div class="w-16 h-16 flex items-center justify-center mx-auto mb-4">
              <img src="/images/mensaje.png" alt="mail" class="w-12 h-12 object-contain">
            </div>
            <h3 class="text-lg font-semibold text-slate-800 mb-2">Email</h3>
            <a href="mailto:sales@printeksupplies.com" class="text-primary-600 hover:text-primary-700 transition-colors block">
              sales@printeksupplies.com
            </a>
          </div>

          <!-- Mexico Phone -->
          <div class="text-center">
            <div class="w-16 h-16 flex items-center justify-center mx-auto mb-4">
              <img src="/images/llamada-telefonica.png" alt="phone" class="w-12 h-12 object-contain">
            </div>
            <h3 class="text-lg font-semibold text-slate-800 mb-2">Mexico</h3>
            <a href="tel:+526567057931" class="text-primary-600 hover:text-primary-700 transition-colors block">
              +52 656 705 7931
            </a>
            <a href="https://wa.me/526567057931" target="_blank" class="text-green-600 hover:text-green-700 transition-colors text-sm mt-1 block">
              WhatsApp
            </a>
          </div>

          <!-- USA Phone -->
          <div class="text-center">
            <div class="w-16 h-16 flex items-center justify-center mx-auto mb-4">
              <img src="/images/llamada-telefonica.png" alt="phone" class="w-12 h-12 object-contain">
            </div>
            <h3 class="text-lg font-semibold text-slate-800 mb-2">United States</h3>
            <a href="tel:+19153072805" class="text-primary-600 hover:text-primary-700 transition-colors block">
              +1 (915) 307 2805
            </a>
            <a href="https://wa.me/19153072805" target="_blank" class="text-green-600 hover:text-green-700 transition-colors text-sm mt-1 block">
              WhatsApp
            </a>
          </div>

          <!-- Schedule -->
          <div class="text-center">
            <div class="w-16 h-16 flex items-center justify-center mx-auto mb-4">
              <img src="/images/reloj.png" alt="clock" class="w-12 h-12 object-contain">
            </div>
            <h3 class="text-lg font-semibold text-slate-800 mb-2">Business Hours</h3>
            <p class="text-slate-600">
              Monday - Friday<br>
              9:00 AM - 6:00 PM
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- FAQ Section -->
  <section class="py-20 bg-gradient-to-br from-slate-100 via-gray-50 to-blue-50">
    <div class="container mx-auto px-4 lg:px-6">
      <div class="max-w-4xl mx-auto">
        <div class="text-center mb-12">
          <h2 class="text-4xl font-heading font-bold text-slate-800 mb-6">
            Frequently Asked Questions
          </h2>
        </div>

        <div class="space-y-6">
          <div class="bg-white rounded-xl p-6 shadow-lg border border-slate-200">
            <h3 class="text-lg font-semibold text-slate-800 mb-3">
              What is the response time for quotes?
            </h3>
            <p class="text-slate-600">
              We are committed to responding to all quote requests within 24 business hours with competitive prices and accurate delivery times.
            </p>
          </div>

          <div class="bg-white rounded-xl p-6 shadow-lg border border-slate-200">
            <h3 class="text-lg font-semibold text-slate-800 mb-3">
              Do you handle international shipping?
            </h3>
            <p class="text-slate-600">
              Yes, with offices in Mexico and the United States, we facilitate international shipping and logistics adapting to each country's regulations.
            </p>
          </div>

          <div class="bg-white rounded-xl p-6 shadow-lg border border-slate-200">
            <h3 class="text-lg font-semibold text-slate-800 mb-3">
              Do you work with companies of any size?
            </h3>
            <p class="text-slate-600">
              Yes, we work with companies from small businesses to multinational corporations, adapting our services and prices to each need and volume.
            </p>
          </div>

          <div class="bg-white rounded-xl p-6 shadow-lg border border-slate-200">
            <h3 class="text-lg font-semibold text-slate-800 mb-3">
              Do you offer emergency services?
            </h3>
            <p class="text-slate-600">
              We have emergency services and express deliveries for critical situations that require immediate attention.
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>

<!-- reCAPTCHA v3 -->
<script src="https://www.google.com/recaptcha/api.js?render=6LfvisUrAAAAAGLWEcGYiuMdNn54E-5T8P90rx__"></script>

// Form submission script - Updated English version matching Spanish functionality
<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.querySelector('form[name="contact"]');
  const submitBtn = document.getElementById('submitBtn');
  const submitText = document.getElementById('submitText');
  const charCount = document.getElementById('charCount');
  const messageField = document.getElementById('mensaje');
  
  let formLoadTime = Date.now();
  let formSubmitted = false;
  
  // Set JavaScript fields
  document.getElementById('formTimestamp').value = formLoadTime;
  document.getElementById('jsEnabled').value = 'true';
  
  // Character counter
  if (messageField && charCount) {
    messageField.addEventListener('input', function() {
      const length = this.value.length;
      charCount.textContent = length;
      
      if (length > 1000) {
        charCount.parentElement.classList.add('text-red-500');
        charCount.parentElement.classList.remove('text-slate-500');
      } else {
        charCount.parentElement.classList.remove('text-red-500');
        charCount.parentElement.classList.add('text-slate-500');
      }
    });
  }
  
  // Enable submit button after 3 seconds
  setTimeout(() => {
    if (submitBtn) {
      submitBtn.disabled = false;
      submitBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
      submitBtn.classList.add('bg-primary-600', 'hover:bg-primary-700');
      if (submitText) {
        submitText.textContent = 'Request Quote';
      }
    }
  }, 3000);
  
  // Basic validation function
  function validateField(field) {
    const errorDiv = field.parentElement.querySelector('.error-message');
    let isValid = true;
    
    field.classList.remove('border-red-400');
    if (errorDiv) {
      errorDiv.classList.add('hidden');
    }
    
    if (field.hasAttribute('required') && !field.value.trim()) {
      isValid = false;
    }
    
    if (field.type === 'email' && field.value) {
      const emailRegex = /^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$/i;
      if (!emailRegex.test(field.value)) {
        isValid = false;
      }
    }
    
    if (!isValid && errorDiv) {
      field.classList.add('border-red-400');
      errorDiv.classList.remove('hidden');
      errorDiv.textContent = field.dataset.errorMessage || 'This field is required';
    }
    
    return isValid;
  }
  
  // Add validation to fields
  const fields = form.querySelectorAll('input[required], select[required], textarea[required]');
  fields.forEach(field => {
    field.addEventListener('blur', () => validateField(field));
  });
  
  // Form submission - Updated to match Spanish version
  form.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    if (formSubmitted) return false;
    
    // Validate all required fields
    let isFormValid = true;
    fields.forEach(field => {
      if (!validateField(field)) {
        isFormValid = false;
      }
    });
    
    // Check honeypot
    const honeypotField = form.querySelector('input[name="bot-field"]');
    const websiteField = form.querySelector('input[name="website"]');
    const companyUrlField = form.querySelector('input[name="company-url"]');
    
    if ((honeypotField && honeypotField.value) || 
        (websiteField && websiteField.value) || 
        (companyUrlField && companyUrlField.value)) {
      console.log('Honeypot triggered');
      return false;
    }
    
    if (!isFormValid) {
      const firstError = form.querySelector('.border-red-400');
      if (firstError) {
        firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
        firstError.focus();
      }
      return false;
    }
    
    formSubmitted = true;
    
    // Show loading
    if (submitBtn && submitText) {
      submitBtn.innerHTML = '<img src="/images/email.png" alt="email" class="w-5 h-5 mr-2" />Sending...';
      submitBtn.disabled = true;
    }
    
    // Get reCAPTCHA token
    let recaptchaToken = null;
    if (typeof grecaptcha !== 'undefined') {
      try {
        recaptchaToken = await grecaptcha.execute('6LfvisUrAAAAAGLWEcGYiuMdNn54E-5T8P90rx__', {action: 'contact_form'});
        console.log('reCAPTCHA token obtained');
      } catch (error) {
        console.log('reCAPTCHA error:', error);
      }
    }
    
    // Try Netlify Function first
    try {
      const templateParams = {
        nombre: document.getElementById('nombre').value.trim(),
        email: document.getElementById('email').value.trim().toLowerCase(),
        telefono: document.getElementById('telefono').value.trim() || 'Not provided',
        empresa: document.getElementById('empresa').value.trim(),
        ubicacion: document.getElementById('ubicacion').value.trim(),
        servicio: document.getElementById('servicio').value,
        numeroProducto: document.getElementById('numeroProducto').value.trim() || 'Not provided',
        marcaModelo: document.getElementById('marcaModelo').value.trim() || 'Not provided',
        mensaje: document.getElementById('mensaje').value.trim(),
        timestamp: formLoadTime.toString(),
        'js-enabled': 'true',
        language: 'English',
        form_source: 'Printek Website Contact Form',
        page_url: window.location.href
      };
      
      console.log('Collected form data:', {
        nombre: templateParams.nombre ? 'OK' : 'MISSING',
        email: templateParams.email ? 'OK' : 'MISSING'
      });
      
      // Prepare payload
      const payload = {
        templateParams: templateParams,
        recaptchaToken: recaptchaToken
      };
      
      console.log('Sending to Resend function...');
      
      const response = await fetch('/.netlify/functions/send-email', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(payload)
      });
      
      console.log('Response status:', response.status);
      console.log('Response ok:', response.ok);
      
      const result = await response.json();
      console.log('Response result:', result);
      
      // Check for success matching Resend function response
      if (response.ok && result.success === true && result.emailId) {
        console.log('✅ Email sent successfully');
        console.log('Email ID:', result.emailId);
        console.log('Redirecting to thank you page...');
        
        // Show success message briefly then redirect
        if (submitBtn && submitText) {
          submitBtn.innerHTML = '<img src="/images/email.png" alt="email" class="w-5 h-5 mr-2" />Success! Redirecting...';
          submitBtn.classList.remove('bg-primary-600');
          submitBtn.classList.add('bg-green-500');
        }
        
        // Redirect with a small delay to show success
        setTimeout(() => {
          window.location.href = '/en/thank-you/';
        }, 1500);
        return;
      } else {
        console.log('❌ Email sending failed');
        console.log('Response details:', { 
          ok: response.ok, 
          success: result.success, 
          emailId: result.emailId,
          error: result.error 
        });
        throw new Error(result.error || `HTTP ${response.status}: Email sending failed`);
      }
    } catch (error) {
      console.log('Netlify function failed:', error);
    }
    
    // Fallback to Netlify Forms
    try {
      const formData = new FormData(form);
      formData.append('g-recaptcha-response', recaptchaToken || '');
      
      const response = await fetch('/', {
        method: 'POST',
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: new URLSearchParams(formData).toString()
      });
      
      if (response.ok) {
        console.log('✅ Sent via Netlify Forms');
        window.location.href = '/en/thank-you/';
        return;
      }
    } catch (error) {
      console.log('Netlify Forms failed:', error);
    }
    
    // If everything fails
    alert('Error sending message. Please contact directly at sales@printeksupplies.com');
    
    // Reset button
    formSubmitted = false;
    if (submitBtn) {
      submitBtn.disabled = false;
      submitBtn.classList.remove('bg-red-500', 'hover:bg-red-600');
      submitBtn.classList.add('bg-primary-600', 'hover:bg-primary-700');
      submitBtn.innerHTML = '<img src="/images/email.png" alt="email" class="w-5 h-5 mr-2" />Request Quote';
    }
  });
  
  // Phone formatting
  const phoneField = document.getElementById('telefono');
  if (phoneField) {
    phoneField.addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length > 0) {
        if (value.startsWith('1') && value.length <= 11) {
          value = value.replace(/(\d{1})(\d{3})(\d{3})(\d{4})/, '+$1 ($2) $3 $4');
        } else if (value.startsWith('52') && value.length <= 12) {
          value = value.replace(/(\d{2})(\d{3})(\d{3})(\d{4})/, '+$1 $2 $3 $4');
        }
      }
      e.target.value = value;
    });
  }

  // Map functionality
  const showMexicoBtn = document.getElementById('showMexico');
  const showUSABtn = document.getElementById('showUSA');
  const googleMap = document.getElementById('googleMap');

  const mexicoMapURL = "https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3368.234567!2d-106.4085409!3d31.709317!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x86e75d350dd9eda9%3A0xa1ef15cd701b0240!2sDacodex%20%7C%20Oficinas%20amuebladas!5e0!3m2!1sen!2smx!4v1702000000001!5m2!1sen!2smx";
  const usaMapURL = "https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3370.0945673!2d-106.3072624!3d31.7465476!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x86e7437e05df51db%3A0xa3470ffb38cfb838!2sPrintek%20Supplies%20Inc!5e0!3m2!1sen!2smx!4v1702000000000!5m2!1sen!2smx";

  if (showMexicoBtn && showUSABtn && googleMap) {
    showMexicoBtn.addEventListener('click', function() {
      googleMap.src = mexicoMapURL;
      showMexicoBtn.classList.remove('bg-red-100');
      showMexicoBtn.classList.add('bg-red-200', 'ring-2', 'ring-red-300');
      showUSABtn.classList.remove('bg-blue-200', 'ring-2', 'ring-blue-300');
      showUSABtn.classList.add('bg-blue-100');
    });

    showUSABtn.addEventListener('click', function() {
      googleMap.src = usaMapURL;
      showUSABtn.classList.remove('bg-blue-100');
      showUSABtn.classList.add('bg-blue-200', 'ring-2', 'ring-blue-300');
      showMexicoBtn.classList.remove('bg-red-200', 'ring-2', 'ring-red-300');
      showMexicoBtn.classList.add('bg-red-100');
    });
  }
});
</script>